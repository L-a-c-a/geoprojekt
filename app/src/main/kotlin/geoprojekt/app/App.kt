/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package geoprojekt.app

import geoprojekt.utilities.*
import geoprojekt.db.*

import io.ktor.server.netty.*
import io.ktor.routing.*
import io.ktor.application.*
import io.ktor.http.*
import io.ktor.request.*
import io.ktor.response.*
import io.ktor.server.engine.*
import io.ktor.features.*
import io.ktor.gson.*

fun main() {
	embeddedServer(Netty, port = 8000) {
    install(ContentNegotiation) { gson {} }
		routing {
			get ("/") {
				call.respondText("Hello, world!")
			}
      get("/nev/{nev}")
      {
        val nev = call.parameters["nev"] ?: "te nemtudomki"
				//call.respond("""{ "Helló": "${nev}"! }""")
        call.respond(Hello(nev))
      }
      post("/nev")
      {
        val hell = call.receive<Hello>()
        call.respond(hell)
      }
      get("konf") { call.respond(KONFIG.konf!!)}  //vigyázz, kiírja a jelszót!

      /* */ get("/ize") { call.respond(Hello(CRUD().q0())) }

      get("/point/{id}")
      {
        val id = call.parameters["id"]?.toIntOrNull()?:0
        call.respond(CRUD().getPgPoint(id))
      }
		}
	}.start(wait = true)
}

data class Hello(val hello:String)